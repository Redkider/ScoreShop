(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/product/product"],{"08a9":function(t,e,a){"use strict";(function(t){a("8cfb"),a("921b");r(a("66fd"));var e=r(a("975f"));function r(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,a("6e42")["createPage"])},"09a6":function(t,e,a){"use strict";var r={"rf-rate":()=>a.e("components/rf-rate/rf-rate").then(a.bind(null,"bbc6")),"rf-badge":()=>a.e("components/rf-badge/rf-badge").then(a.bind(null,"4e33")),"rf-loading":()=>a.e("components/rf-loading/rf-loading").then(a.bind(null,"6109"))},n=function(){var t=this,e=t.$createElement,a=(t._self._c,parseFloat(t.productDetail.market_price)),r=parseFloat(t.productDetail.price),n=parseFloat(t.productDetail.market_price),i=parseFloat(t.productDetail.price),c=t._f("discountFilter")((t.currentSkuPrice||t.productDetail.price)/t.productDetail.market_price),s=t._f("maxBuyFilter")(t.productDetail.max_buy),u=t._f("pointExchangeTypeFilter")(t.productDetail.point_exchange_type),o=t._f("integralGiveTypeFilter")(t.productDetail.integral_give_type),l=t._f("givePointFilter")(t.productDetail),p=t.__map(t.productDetail.ladderPreferential,function(e,a){var r=parseInt(e.type,10),n=parseInt(e.type,10),i=parseInt(e.price,10);return{$orig:t.__get_orig(e),m4:r,m5:n,m6:i}}),d=t._f("time")(t.productDetail.evaluate&&t.productDetail.evaluate[0]&&t.productDetail.evaluate[0].created_at),h=t._f("formatRichText")(t.productDetail.intro),f=t.__map(t.productDetail.ladderPreferential,function(e,a){var r=parseInt(e.type,10),n=parseInt(e.type,10),i=parseInt(e.price,10);return{$orig:t.__get_orig(e),m7:r,m8:n,m9:i}}),g=t.__map(t.specList,function(e,a){var r=parseInt(e.show_type),n=parseInt(e.show_type),i=parseInt(e.show_type),c=parseInt(e.show_type);return{$orig:t.__get_orig(e),m10:r,m11:n,m12:i,m13:c}}),m=parseInt(t.currentStock||t.productDetail.stock,10),v=t.__map(t.productDetail.canReceiveCoupon,function(e,a){var r=parseInt(e.term_of_validity_type,10),n=t._f("time")(e.start_time),i=t._f("time")(e.end_time),c=parseInt(e.range_type,10);return{$orig:t.__get_orig(e),m15:r,f7:n,f8:i,m16:c}});t.$mp.data=Object.assign({},{$root:{m0:a,m1:r,m2:n,m3:i,f0:c,f1:s,f2:u,f3:o,f4:l,l0:p,f5:d,f6:h,l1:f,l2:g,m14:m,l3:v}})},i=[];a.d(e,"b",function(){return n}),a.d(e,"c",function(){return i}),a.d(e,"a",function(){return r})},"3e2b":function(t,e,a){"use strict";a.r(e);var r=a("57d1"),n=a.n(r);for(var i in r)"default"!==i&&function(t){a.d(e,t,function(){return r[t]})}(i);e["default"]=n.a},"57d1":function(t,e,a){"use strict";(function(t,r){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=s(a("a34a")),i=a("2f62"),c=(a("00ba"),a("c7a8"),s(a("f0be")));a("0142");function s(t){return t&&t.__esModule?t:{default:t}}function u(t){return p(t)||l(t)||o()}function o(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function l(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function p(t){if(Array.isArray(t)){for(var e=0,a=new Array(t.length);e<t.length;e++)a[e]=t[e];return a}}function d(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{},r=Object.keys(a);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(a).filter(function(t){return Object.getOwnPropertyDescriptor(a,t).enumerable}))),r.forEach(function(e){h(t,e,a[e])})}return t}function h(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function f(t,e,a,r,n,i,c){try{var s=t[i](c),u=s.value}catch(o){return void a(o)}s.done?e(u):Promise.resolve(u).then(r,n)}function g(t){return function(){var e=this,a=arguments;return new Promise(function(r,n){var i=t.apply(e,a);function c(t){f(i,r,n,c,s,"next",t)}function s(t){f(i,r,n,c,s,"throw",t)}c(void 0)})}}var m=function(){return a.e("components/share").then(a.bind(null,"d620"))},v=function(){return a.e("components/uni-number-box").then(a.bind(null,"013d"))},b=function(){return a.e("components/empty").then(a.bind(null,"b40f"))},_=function(){return a.e("components/rf-rate/rf-rate").then(a.bind(null,"bbc6"))},y=function(){return a.e("components/rf-badge/rf-badge").then(a.bind(null,"4e33"))},k={components:{rfBadge:y,share:m,rfRate:_,uniNumberBox:v,empty:b},filters:{formatRichText:function(t){if(t){var e=t.replace(/<img[^>]*>/gi,function(t,e){return t=t.replace(/style="[^"]+"/gi,"").replace(/style='[^']+'/gi,""),t=t.replace(/width="[^"]+"/gi,"").replace(/width='[^']+'/gi,""),t=t.replace(/height="[^"]+"/gi,"").replace(/height='[^']+'/gi,""),t});return e=e.replace(/style="[^"]+"/gi,function(t,e){return t=t.replace(/width:[^;]+;/gi,"max-width:100%;").replace(/width:[^;]+;/gi,"max-width:100%;"),t}),e=e.replace(/<br[^>]*\/>/gi,""),e=e.replace(/\<img/gi,'<img style="max-width:100%;height:auto;display:inline-block;margin:10rpx auto;"'),e}return"暂无商品详情"},time:function(t){return(0,c.default)(1e3*t).format("YYYY-MM-DD HH:mm")},discountFilter:function(t){return 10*t.toFixed(2)},maxBuyFilter:function(t){return 0===parseInt(t,10)?"不限购":"限购：".concat(t)},pointExchangeTypeFilter:function(t){var e=["非积分兑换","积分加现金","直接购买","只支持积分兑换"];return e[parseInt(t,10)]},integralGiveTypeFilter:function(t){var e=["固定积分","百分比"];return e[parseInt(t,10)]},givePointFilter:function(t){return 0==parseInt(t.integral_give_type,10)?parseInt(t.give_point,10):parseInt(t.price*t.percentum/100,10)}},data:function(){return{serviceClass:"none",ladderPreferentialClass:"none",attributeValueClass:"none",cartType:null,maskState:0,couponList:[],productDetail:{},styleObject:{},showTypeImage:null,specClass:"none",specSelected:[],favorite:!1,shareList:[],currentStock:null,currentSkuPrice:null,specList:[],specChildList:[],cartCount:1,product_id:null,evaluateList:[],token:null,cartNum:null,loading:!0,userInfo:{},errorInfo:""}},onLoad:function(){var t=g(n.default.mark(function t(e){var a=this;return n.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:this.initData(e.id),this.specList.forEach(function(t){var e=!0,r=!1,n=void 0;try{for(var i,c=a.specChildList[Symbol.iterator]();!(e=(i=c.next()).done);e=!0){var s=i.value;if(s.pid===t.id){a.$set(s,"selected",!0),a.specSelected.push(s);break}}}catch(u){r=!0,n=u}finally{try{e||null==c.return||c.return()}finally{if(r)throw n}}}),this.product_id=e.id;case 3:case"end":return t.stop()}},t,this)}));function e(e){return t.apply(this,arguments)}return e}(),onShareAppMessage:function(t){},methods:d({},(0,i.mapMutations)(["handle","addCartList","getcartNum"]),{showService:function(){this.productDetail.tags&&0===this.productDetail.tags.length||(this.serviceClass="show")},showLadderPreferential:function(){0!==this.productDetail.ladderPreferential.length&&(this.ladderPreferentialClass="show")},showAttributeValue:function(){0!==this.productDetail.attributeValue.length&&(this.attributeValueClass="show")},shareToH5:function(){this.$api.msg("请复制连接进行分享")},hideService:function(){var t=this;this.serviceClass="hide",this.ladderPreferentialClass="hide",this.attributeValueClass="hide",setTimeout(function(){t.serviceClass="none",t.ladderPreferentialClass="none",t.attributeValueClass="none"},200)},getCoupon:function(){var e=g(n.default.mark(function e(a){var i=this;return n.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(this.token){e.next=4;break}return this.maskState=0,t.showModal({content:"会话已过期，是否跳转登录页面？",success:function(e){e.confirm&&(t.clearStorage(),t.reLaunch({url:"/pages/public/login"}))}}),e.abrupt("return");case 4:return e.next=6,this.$get("http://localhost:8080/static/api/couponList.json",{}).then(function(t){for(var e=0;e<t.data.length;e++)t.data[e].id==a.id&&(i.$api.msg("领取成功"),i.maskState=0)}).catch(function(t){i.maskState=0,r("log",t," at pages\\product\\product.vue:605")});case 6:case"end":return e.stop()}},e,this)}));function a(t){return e.apply(this,arguments)}return a}(),toEvaluateList:function(){t.navigateTo({url:"/pages/evaluation/list?comment_num=".concat(this.productDetail.comment_num,"&evaluateStat=").concat(JSON.stringify(this.productDetail.evaluateStat))})},numberChange:function(t){this.cartCount=t.number},toggleMask:function(t){var e=this;if(this.productDetail.id){var a="show"===t?10:300,r="show"===t?1:0;this.maskState=2,setTimeout(function(){e.maskState=r},a)}},initData:function(){var e=g(n.default.mark(function e(a){return n.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.userInfo=t.getStorageSync("userInfo"),this.token=this.userInfo.id,this.cartNum=t.getStorageSync("cartNum"),e.next=5,this.getProductDetail(a);case 5:case"end":return e.stop()}},e,this)}));function a(t){return e.apply(this,arguments)}return a}(),getProductDetail:function(){var t=g(n.default.mark(function t(e){var a=this;return n.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$get("http://localhost:8080/static/api/productDetail.json?id=`${id}`",{id:e}).then(function(){var t=g(n.default.mark(function t(i){var c,s;return n.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:a.loading=!1,r("log",i.data," at pages\\product\\product.vue:661"),c=0;case 3:if(!(c<i.data.length)){t.next=9;break}if(i.data[c].id!=e){t.next=6;break}return t.abrupt("return",a.productDetail=i.data[c]);case 6:c++,t.next=3;break;case 9:r("log",a.productDetail.evaluate," at pages\\product\\product.vue:670"),a.evaluateList=a.productDetail.evaluate,a.favorite=!!a.productDetail.myCollect,a.specList=a.productDetail.base_attribute_format,a.specList.forEach(function(t){a.specChildList=[].concat(u(a.specChildList),u(t.value))}),a.specSelected=[],i.data.base_attribute_format.forEach(function(t){t.value[0].selected=!0,a.specSelected.push(t.value[0])}),s=[],a.specSelected.forEach(function(t){s.push(t.base_spec_value_id)}),a.productDetail.sku.forEach(function(t){if(t.data===s.join("-"))return a.currentStock=t.stock,void(a.currentSkuPrice=t.price)});case 19:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()).catch(function(t){a.loading=!1,a.errorInfo=t});case 2:case"end":return t.stop()}},t,this)}));function e(e){return t.apply(this,arguments)}return e}(),toggleSpec:function(){var e=this;if(this.productDetail.id)if("show"===this.specClass){if(!this.token)return this.specClass="none",void t.showModal({content:"会话已过期，是否跳转登录页面？",success:function(e){e.confirm&&(t.clearStorage(),t.reLaunch({url:"/pages/public/login"}))}});if(this.specSelected.length<this.productDetail.base_attribute_format.length)return void this.$api.msg("请先选择规格");"cart"===this.cartType?(this.cartType=null,this.handleCartItemCreate()):"buy"===this.cartType&&(this.cartType=null,this.buy()),this.specClass="hide",setTimeout(function(){e.specClass="none"},250)}else"none"===this.specClass&&(this.specClass="show")},hideSpec:function(){var t=this;this.specClass="hide",setTimeout(function(){t.specClass="none"},250)},handleCartItemCreate:function(){var e=g(n.default.mark(function e(){var a,i,c=this;return n.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(i=null,1!==this.productDetail.sku.length){e.next=5;break}a=this.productDetail.sku[0].id,e.next=31;break;case 5:if(1!==this.productDetail.base_attribute_format.length){e.next=14;break}if(!(this.specSelected.length<1)){e.next=11;break}return this.$api.msg("请先选择规格"),e.abrupt("return");case 11:i="".concat(this.specSelected[0].base_spec_value_id);case 12:e.next=30;break;case 14:if(2!==this.productDetail.base_attribute_format.length){e.next=23;break}if(!(this.specSelected.length<2)){e.next=20;break}return this.$api.msg("请先选择规格"),e.abrupt("return");case 20:i="".concat(this.specSelected[0].base_spec_value_id,"-").concat(this.specSelected[1].base_spec_value_id);case 21:e.next=30;break;case 23:if(3!==this.productDetail.base_attribute_format.length){e.next=30;break}if(!(this.specSelected.length<3)){e.next=29;break}return this.$api.msg("请先选择规格"),e.abrupt("return");case 29:i="".concat(this.specSelected[0].base_spec_value_id,"-").concat(this.specSelected[1].base_spec_value_id,"-").concat(this.specSelected[2].base_spec_value_id);case 30:this.productDetail&&this.productDetail.sku.forEach(function(t){t.data!==i||(a=t.id)});case 31:return e.next=33,this.$get("http://localhost:8080/static/api/cartItemList.json",{sku_id:a,num:this.cartCount}).then(function(){var e=g(n.default.mark(function e(r){var i,s;return n.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:for(i=0,s=0;s<r.data.length;s++)r.data[s].id==a&&(r.data[s].amount+=num),i+=r.data[s].amount;t.setStorageSync("cartNum",i),c.cartNum=i,c.getcartNum(c.cartNum),c.$api.msg("添加成功，在购物车等"),c.addCartList(r.data);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()).catch(function(t){r("log",t," at pages\\product\\product.vue:813")});case 33:case"end":return e.stop()}},e,this)}));function a(){return e.apply(this,arguments)}return a}(),selectSpec:function(t,e,a){var r=this,n=this.specChildList;n.forEach(function(t){t.base_spec_id===e&&r.$set(t,"selected",!1)}),3===parseInt(a,10)&&(this.showTypeImage=n[t].data),2===parseInt(a,10)&&(this.styleObject={color:n[t].data}),this.$set(n[t],"selected",!0),this.specSelected=[],n.forEach(function(t){!0===t.selected&&r.specSelected.push(t)});var i=[];this.specSelected.forEach(function(t){i.push(t.base_spec_value_id)}),this.productDetail.sku.forEach(function(t){if(t.data===i.join("-"))return r.currentStock=t.stock,void(r.currentSkuPrice=t.price)})},share:function(t){return"button"===t.from&&r("log",t.target," at pages\\product\\product.vue:879"),{title:"自定义分享标题",path:"/pages/test/test?id=123"}},toFavorite:function(){var e=g(n.default.mark(function e(){return n.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(this.productDetail.id){e.next=2;break}return e.abrupt("return");case 2:this.token?this.favorite?this.handleCollectDel():this.handleCollectCreate():(this.specClass="none",t.showModal({content:"会话已过期，是否跳转登录页面？",success:function(e){e.confirm&&(t.clearStorage(),t.reLaunch({url:"/pages/public/logintype"}))}}));case 3:case"end":return e.stop()}},e,this)}));function a(){return e.apply(this,arguments)}return a}(),handleCollectCreate:function(){var e=g(n.default.mark(function e(){var a=this;return n.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$get("http://localhost:8080/static/api/handleCollect.json",{}).then(function(e){for(var n=0;n<e.data.length;n++)e.data[n].productId==a.product_id&&e.data[n].user==a.userInfo.phone&&(a.favorite=!e.data[n].favorite,r("log","收藏:"+a.favorite," at pages\\product\\product.vue:929"),a.handle(e.data),t.setStorage({key:"handleCollect",data:e.data}));a.$api.msg("收藏成功")}).catch(function(t){r("log",t," at pages\\product\\product.vue:942")});case 2:case"end":return e.stop()}},e,this)}));function a(){return e.apply(this,arguments)}return a}(),handleCollectDel:function(){var t=g(n.default.mark(function t(){var e=this;return n.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$get("http://localhost:8080/static/api/handleCollect.json").then(function(t){for(var a=0;a<t.data.length;a++)t.data[a].productId==e.product_id&&t.data[a].user==e.userInfo.phone&&(t.data[a].favorite=!0,e.favorite=!t.data[a].favorite,r("log","取消:"+e.favorite," at pages\\product\\product.vue:958"));e.$api.msg("取消收藏成功")}).catch(function(t){r("log",t," at pages\\product\\product.vue:964")});case 2:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),buy:function(){var e=g(n.default.mark(function e(){var a,r,i,c;return n.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(1!==this.productDetail.sku.length){e.next=4;break}a=this.productDetail.sku[0].id,e.next=33;break;case 4:if(1!==this.productDetail.base_attribute_format.length){e.next=14;break}if(!(this.specSelected.length<1)){e.next=10;break}return this.$api.msg("请先选择规格"),e.abrupt("return");case 10:r="".concat(this.specSelected[0].base_spec_value_id),"".concat(this.specSelected[0].title);case 12:e.next=32;break;case 14:if(2!==this.productDetail.base_attribute_format.length){e.next=24;break}if(!(this.specSelected.length<2)){e.next=20;break}return this.$api.msg("请先选择规格"),e.abrupt("return");case 20:r="".concat(this.specSelected[0].base_spec_value_id,"-").concat(this.specSelected[1].base_spec_value_id),"".concat(this.specSelected[0].title," ").concat(this.specSelected[1].title);case 22:e.next=32;break;case 24:if(3!==this.productDetail.base_attribute_format.length){e.next=32;break}if(!(this.specSelected.length<3)){e.next=30;break}return this.$api.msg("请先选择规格"),e.abrupt("return");case 30:r="".concat(this.specSelected[0].base_spec_value_id,"-").concat(this.specSelected[1].base_spec_value_id,"-").concat(this.specSelected[2].base_spec_value_id),"".concat(this.specSelected[0].title," ").concat(this.specSelected[1].title," ").concat(this.specSelected[2].title);case 32:this.productDetail&&this.productDetail.sku.forEach(function(t){t.data!==r||(a=t.id)});case 33:i={},c={},c.sku_id=a,c.num=this.cartCount,2==this.productDetail.point_exchange_type||4==this.productDetail.point_exchange_type?i.type="point_exchange":i.type="buy_now",i.data=JSON.stringify(c),t.navigateTo({url:"/pages/order/createOrder?data=".concat(JSON.stringify(i))});case 40:case"end":return e.stop()}},e,this)}));function a(){return e.apply(this,arguments)}return a}(),addCart:function(t){this.productDetail.id&&(this.specClass="show",this.cartType=t)},stopPrevent:function(){}})};e.default=k}).call(this,a("6e42")["default"],a("0de9")["default"])},"975f":function(t,e,a){"use strict";a.r(e);var r=a("09a6"),n=a("3e2b");for(var i in n)"default"!==i&&function(t){a.d(e,t,function(){return n[t]})}(i);a("c6cc");var c,s=a("f0c5"),u=Object(s["a"])(n["default"],r["b"],r["c"],!1,null,"773c7e0e",null,!1,r["a"],c);e["default"]=u.exports},a5c7:function(t,e,a){},c6cc:function(t,e,a){"use strict";var r=a("a5c7"),n=a.n(r);n.a}},[["08a9","common/runtime","common/vendor"]]]);